<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>YouTube Live Streaming Scheduler</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>
  <body>
    <header class="app-header">
      <div class="branding">
        <i class="fa-solid fa-tower-broadcast"></i>
        <h1>YouTube Live Streaming Scheduler</h1>
      </div>
      <div class="status-bar">
        <span class="status-item"><i class="fa-regular fa-heart"></i> <span id="health-status">Checking…</span></span>
        <span class="status-item"><i class="fa-solid fa-signal"></i> Active Streams: <span id="streams-count">—</span></span>
        <span class="status-item" style="margin-left:auto;">
          <button id="theme-toggle" class="btn small" title="Toggle theme"><i class="fa-regular fa-moon"></i> Dark</button>
        </span>
      </div>
    </header>

    <!-- Main Navigation -->
    <nav id="main-nav" class="main-nav" role="navigation" aria-label="Primary">
      <button class="nav-link" data-view="active"><i class="fa-solid fa-signal"></i> Active Streams <span id="nav-active-count" class="badge-pill">0</span></button>
      <button class="nav-link" data-view="playlist"><i class="fa-solid fa-list"></i> Playlist</button>
      <button class="nav-link active" data-view="live"><i class="fa-solid fa-signal"></i> Live Stream</button>
      <button class="nav-link" data-view="library"><i class="fa-regular fa-folder"></i> Video Library</button>
    </nav>

    <main class="container">
      <!-- Active Streams Section -->
      <section id="section-active-streams" class="card" aria-labelledby="active-streams-title">
        <div class="section-header">
          <h2 id="active-streams-title"><i class="fa-solid fa-signal"></i> Active Streams</h2>
        </div>
        <div id="active-streams-list" class="grid" aria-live="polite"></div>
        <div id="active-streams-empty" class="empty" hidden>
          <i class="fa-regular fa-face-smile"></i>
          <p>No active streams right now.</p>
        </div>
      </section>
      <!-- Stream from URL Section -->
      <section id="section-url-stream" class="card" aria-labelledby="url-stream-title">
        <div class="section-header">
          <h2 id="url-stream-title"><i class="fa-brands fa-youtube"></i> Stream from URL</h2>
        </div>
        <form id="url-stream-form" class="form-grid">
          <div class="form-row">
            <label for="url-source">YouTube Video URL</label>
            <input id="url-source" type="url" name="sourceUrl" placeholder="https://www.youtube.com/watch?v=..." required />
            <small>Public videos recommended. Age-restricted content may fail.</small>
          </div>
          <div class="form-row">
            <label for="url-rtmpUrl">RTMP URL</label>
            <input id="url-rtmpUrl" type="text" name="rtmpUrl" value="rtmp://a.rtmp.youtube.com/live2" required />
          </div>
          <div class="form-row">
            <label for="url-streamKey">Stream Key</label>
            <input id="url-streamKey" type="password" name="streamKey" placeholder="Enter your stream key" required />
            <small>
              Find it in YouTube Live Control Room. <a href="#" id="yt-help-link">Need help?</a>
            </small>
          </div>
          <div class="form-row">
            <label for="url-scheduleStart">Schedule Start (UTC)</label>
            <input id="url-scheduleStart" type="datetime-local" name="scheduleTime" />
            <small>Leave empty to start immediately.</small>
          </div>
          <div class="form-row">
            <label for="url-scheduleStop">Stop Time (optional, UTC)</label>
            <input id="url-scheduleStop" type="datetime-local" name="stopTime" />
            <small>Auto-stop external stream at this time.</small>
          </div>
          <div class="form-actions">
            <button type="submit" id="url-start-btn" class="btn primary"><i class="fa-solid fa-play"></i> Start from URL</button>
            <button type="button" id="url-stop-btn" class="btn" hidden><i class="fa-solid fa-stop"></i> Stop</button>
            <button type="button" id="url-schedule-btn" class="btn outline"><i class="fa-regular fa-calendar"></i> Schedule from URL</button>
            <button type="button" id="url-cancel-schedule-btn" class="btn outline"><i class="fa-regular fa-calendar-xmark"></i> Cancel Schedule</button>
          </div>
          <div id="url-message" class="message" role="alert" aria-live="polite"></div>
          <div id="url-status" class="status" aria-live="polite"></div>
        </form>
      </section>
      <!-- Create Playlist Section -->
      <section id="section-playlist-form" class="card" aria-labelledby="playlist-title" hidden>
        <div class="section-header">
          <h2 id="playlist-title"><i class="fa-solid fa-list"></i> Create Playlist</h2>
        </div>
        <form id="playlist-form" class="form-grid">
          <div class="form-row">
            <label for="playlist-name">Playlist Name</label>
            <input id="playlist-name" type="text" name="name" placeholder="Morning Stream Marathon" required />
          </div>
          <div class="form-row">
            <label for="playlist-scheduledAt">Schedule Date &amp; Time</label>
            <input id="playlist-scheduledAt" type="datetime-local" name="scheduledAt" required />
          </div>
          <div class="form-row">
            <label for="playlist-rtmpUrl">RTMP URL (playlist)</label>
            <input id="playlist-rtmpUrl" type="text" name="rtmpUrl" value="rtmp://a.rtmp.youtube.com/live2" required />
            <small>Applied to all items in the playlist.</small>
          </div>
          <div class="form-row">
            <label for="playlist-streamKey">Stream Key (playlist)</label>
            <input id="playlist-streamKey" type="password" name="streamKey" placeholder="Enter your stream key" required />
          </div>
          <div class="form-row">
            <label class="checkbox">
              <input id="playlist-loop" type="checkbox" name="loop" />
              <span>Loop playlist (repeat videos continuously)</span>
            </label>
            <small>When enabled, the playlist restarts after the last item.</small>
          </div>
          <div class="form-row">
            <label>Select Videos</label>
            <div id="playlist-video-selector" class="selector"></div>
            <small>Select multiple videos to run sequentially.</small>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn primary"><i class="fa-solid fa-list-check"></i> Create Playlist</button>
          </div>
          <div id="playlist-message" class="message" role="alert" aria-live="polite"></div>
        </form>
      </section>
      <!-- Upload Section -->
      <section id="section-upload" class="card" aria-labelledby="upload-title">
        <div class="section-header">
          <h2 id="upload-title"><i class="fa-solid fa-upload"></i> Upload Video</h2>
        </div>
        <form id="upload-form" class="form-grid">
          <div class="form-row">
            <label for="title">Video Title</label>
            <input id="title" type="text" name="title" placeholder="My Awesome Stream" required />
          </div>

          <div class="form-row">
            <label for="file">Video File</label>
            <input id="file" type="file" name="file" accept="video/*" required />
            <small id="file-info"><span id="file-size">—</span> • Estimated upload: <span id="upload-estimate">—</span></small>
          </div>

          <div class="form-row">
            <label for="scheduledAt">Schedule Date &amp; Time</label>
            <input id="scheduledAt" type="datetime-local" name="scheduledAt" required />
          </div>

          <div class="form-row">
            <label for="stopAt">Stop At (optional)</label>
            <input id="stopAt" type="datetime-local" name="stopAt" />
            <small>Stream will auto-stop at this time.</small>
          </div>

          <div class="form-row">
            <label for="rtmpUrl">RTMP URL</label>
            <input id="rtmpUrl" type="text" name="rtmpUrl" value="rtmp://a.rtmp.youtube.com/live2" required />
          </div>

          <div class="form-row">
            <label for="streamKey">Stream Key</label>
            <input id="streamKey" type="password" name="streamKey" placeholder="Enter your stream key" required />
          </div>
          <div class="form-row">
            <label class="checkbox">
              <input id="loop" type="checkbox" name="loop" />
              <span>Loop video (continuous stream until stopped)</span>
            </label>
            <small>Stops automatically at Stop At time if provided.</small>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn primary"><i class="fa-solid fa-paper-plane"></i> Upload</button>
          </div>

          <div id="upload-progress" class="progress" hidden>
            <div id="upload-progress-bar" class="progress-bar" style="width:0%"></div>
          </div>
        </form>
        <div id="message" class="message" role="alert" aria-live="polite"></div>
      </section>

      <!-- Upload to Library Section -->
      <section id="section-library-upload" class="card" aria-labelledby="library-upload-title" hidden>
        <div class="section-header">
          <h2 id="library-upload-title"><i class="fa-regular fa-folder"></i> Upload to Library</h2>
        </div>
        <form id="library-upload-form" class="form-grid">
          <div class="form-row">
            <label for="library-title">Video Title</label>
            <input id="library-title" type="text" name="title" placeholder="My Saved Video" required />
          </div>

          <div class="form-row">
            <label for="library-file">Video File</label>
            <input id="library-file" type="file" name="file" accept="video/*" required />
            <small><span id="library-file-size">—</span></small>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn"><i class="fa-solid fa-floppy-disk"></i> Save to Library</button>
          </div>

          <div id="library-upload-progress" class="progress" hidden>
            <div id="library-upload-progress-bar" class="progress-bar" style="width:0%"></div>
          </div>
        </form>
        <div id="library-message" class="message" role="alert" aria-live="polite"></div>
      </section>

      <!-- Video List Section -->
      <section id="section-videos" class="card" aria-labelledby="videos-title">
        <div class="section-header">
          <h2 id="videos-title"><i class="fa-solid fa-film"></i> Videos</h2>
          <div class="controls">
            <div class="filters" id="filter-buttons" role="group" aria-label="Filters">
              <button class="btn filter active" data-status="">All</button>
              <button class="btn filter" data-status="library">Library</button>
              <button class="btn filter" data-status="scheduled">Scheduled</button>
              <button class="btn filter" data-status="streaming">Streaming</button>
              <button class="btn filter" data-status="completed">Completed</button>
              <button class="btn filter" data-status="failed">Failed</button>
            </div>
            <div class="search">
              <input id="search-input" type="search" placeholder="Search by title…" />
            </div>
          </div>
        </div>

        <div id="videos-grid" class="grid" aria-live="polite" aria-busy="false"></div>
        <!-- Back-compat list for existing JS -->
        <ul id="videos-list" class="legacy-list" hidden></ul>

        <div id="empty-state" class="empty" hidden>
          <i class="fa-regular fa-face-sad-tear"></i>
          <p>No videos found. Upload one to get started.</p>
        </div>
      </section>

      <!-- Playlists Section -->
      <section id="section-playlists" class="card" aria-labelledby="playlists-title" hidden>
        <div class="section-header">
          <h2 id="playlists-title"><i class="fa-solid fa-layer-group"></i> Playlists</h2>
        </div>
        <div id="playlists-list" class="grid" aria-live="polite"></div>
        <div id="playlists-empty" class="empty" hidden>
          <i class="fa-regular fa-face-smile"></i>
          <p>No playlists yet. Create one above.</p>
        </div>
      </section>

      <!-- Footer -->
      <footer class="app-footer">
        <div class="links">
          <a href="#" id="instructions-link"><i class="fa-regular fa-circle-question"></i> Instructions</a>
          <a href="#" id="github-link"><i class="fa-brands fa-github"></i> GitHub</a>
        </div>
        <div class="copyright">&copy; <span id="year"></span> Live Scheduler</div>
      </footer>
    </main>

    <!-- Loading Spinner Component -->
    <div id="global-spinner" class="spinner" hidden>
      <div class="spinner-inner"></div>
    </div>

    <script>
      // Set min attribute on schedule to now
      (function () {
        const el = document.getElementById('scheduledAt');
        if (!el) return;
        const pad = (n) => String(n).padStart(2, '0');
        const d = new Date();
        const val = `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
        el.min = val;
      })();

      // File info and basic upload time estimate (assumes ~10 MB/s)
      (function () {
        const fileEl = document.getElementById('file');
        const sizeEl = document.getElementById('file-size');
        const estEl = document.getElementById('upload-estimate');
        if (!fileEl) return;
        fileEl.addEventListener('change', () => {
          const f = fileEl.files && fileEl.files[0];
          if (!f) { sizeEl.textContent = '—'; estEl.textContent = '—'; return; }
          const mb = (f.size / (1024 * 1024));
          sizeEl.textContent = `${mb.toFixed(1)} MB`;
          const sec = mb / 10; // naive 10MB/s
          const mins = Math.floor(sec / 60);
          const rem = Math.round(sec % 60);
          estEl.textContent = mins > 0 ? `${mins}m ${rem}s` : `${rem}s`;
        });
      })();

      // Footer year
      (function () { var y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear(); })();
    </script>

    <script src="js/config.js"></script>
    <script src="js/app.js"></script>
  </body>
  </html>